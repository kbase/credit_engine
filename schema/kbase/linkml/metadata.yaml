id: https://kbase/credit_engine/schema/metadata
name: metadata
description: Schema for KBase resource metadata
prefixes:
  biolink: https://w3id.org/biolink/vocab/
  credit: https://casrai.org/credit/
  crossref: https://crossref.org/
  datacite: https://purl.org/datacite/v4.4
  DOI: http://identifiers.org/doi/
  linkml: https://w3id.org/linkml/
  ORCID: http://identifiers.org/orcid/
  OSTI: https://www.osti.gov/biblio/
  ROR: https://ror.org/
  schema: http://schema.org/
imports:
  - linkml:types
default_range: string

classes:

  Resource:
    description: A data source of some type.
    attributes:
      identifier:
        description: resolvable persistent unique ID for the resource
        identifier: true
        range: ResolvablePID
        required: true
        exact_mappings:
        - DataCite:id
          # from: DataCite:id
          # via: { id: "DOI:{DataCite:id}" }
        - OSTI:osti_id
          # from: OSTI:osti_id
          # via: { id: "OSTI:{OSTI:osti_id}"}
        - JGI:organisms[].grouped_by
          # from JGI:organisms[].grouped_by
          # via: { id: JGI:organisms[].files[].{JGI:organisms[].grouped_by} }

      resource_type:
        description: the type of resource being described
        range: ResourceType
        required: true
        exact_mappings:
        - OSTI:product_type
        # see DataCite:attributes.types
        - DataCite:attributes.types.schema_org
        examples:
        - value: dataset
        - value: report

      title:
        description: formal title(s) of the data set
        multivalued: true
        exact_mappings:
        - DataCite:attributes.titles[].title
        - OSTI:title
          # from: OSTI:title
          # via: [OSTI:title]
        examples:
        - value: Viral Annotation Pipeline in KBase

      version:
        description: resource version (if available)
        exact_mappings:
        - DataCite:attributes.version

      dates:
        description: lifecycle dates for the resource
        inlined_as_list: true
        multivalued: true
        range: EventDate
        examples:
        - value: { date: 2022-05-10, date_type: available }
        close_mappings:
        - DataCite:attributes.published
          # from DataCite:attributes.published
          # via { date: DataCite:attributes.published, date_type: published }
        - OSTI:publication_date
          # from: OSTI:publication_date
          # via { date: OSTI:publication_date, date_type: published }

      contributors:
        description: people and/or organisations responsible for generating the resource
        inlined_as_list: true
        multivalued: true
        range: Person
        narrow_mappings:
        - DataCite:attributes.contributors
        - DataCite:attributes.creators
        - OSTI:contributors
        - OSTI:authors
        - JGI:organisms[].pi
        todos: this should include organisations as well as people

      related_identifiers:
        description: other resolvable persistent unique IDs used to access the resource or related resources
        inlined_as_list: true
        multivalued: true
        range: ResolvablePID
        close_mappings:
        - DataCite:attributes.identifiers
        - DataCite:attributes.related_identifiers
        - DataCite:attributes.alternate_identifiers
        - OSTI:related_identifiers
        - OSTI:doi
          # from: OSTI:doi
          # via: { id: "DOI:{OSTI:doi}"}

      funding:
        description: funding sources for the resource
        inlined_as_list: true
        multivalued: true
        range: FundingReference
        close_mappings:
        - DataCite:attributes.funding_references
        - CrossRef:Message.project.funding

      license:
        description: license under which the data is made available
        slot_uri: biolink:license
        examples:
        - value: CC-BY-4.0
        - value: CC0
        related_mappings:
        # TODO: coercion?
        - DataCite:attributes.rights_list


  Person:
    description: A human or human-like entity.
    attributes:
      orcid:
        identifier: true
        description: ORCID
        range: uriorcurie
        examples:
        - value: ORCID:0000-0001-9557-7715
        exact_mappings:
        - DataCite:attributes.contributors[].name_identifiers[].name_identifier_scheme == 'ORCID'
        - DataCite:attributes.creators[].name_identifiers[].name_identifier_scheme == 'ORCID'
          # from: DataCite:attributes.contributors[].name_identifiers[].name_identifier_scheme == 'ORCID'
          # via: "ORCID:{ DataCite:attributes.contributors[].name_identifiers[].name_identifier.replace('https://orcid.org/', '') }"
        - OSTI:orcid

      first_name:
        description: given name
        examples:
        - value: Ellen
        exact_mappings:
        - DataCite:attributes.creators[].given_name
        - DataCite:attributes.contributors[].given_name
        - OSTI:first_name
        - JGI:organisms[].pi.first_name

      last_name:
        description: family name
        examples:
        - value: Dow
        exact_mappings:
        - DataCite:attributes.creators[].family_name
        - DataCite:attributes.contributors[].family_name
        - OSTI:last_name
        - JGI:organisms[].pi.last_name

      full_name:
        description: Full name of the contributor
        # slot_uri: schema:name
        equals_expression: "{first_name} + {last_name}"
        examples:
        - value: Ellen Dow
        - value: Vlad the Impaler
        - value: Madonna
        related_mappings:
        # these have the names comma-separated and inverted
        - DataCite:attributes.creators[].name
        - DataCite:attributes.contributors[].name
        exact_mappings:
        - JGI:organisms[].pi.name

      affiliations:
        description: organisation(s) that the contributor is associated with
        inlined_as_list: true
        multivalued: true
        range: Organisation
        related_mappings:
        - DataCite:attributes.contributors[].affiliation[]
          # from: DataCite:attributes.contributors[].affiliation[]
          # via: {
          #   organisation_name: "DataCite:attributes.contributors[].affiliation[].name"
          # }
        - DataCite:attributes.creators[].affiliation[]
          # from: DataCite:attributes.creators[].affiliation[]
          # via: {
          #   organisation_name: "DataCite:attributes.creators[].affiliation[].name"
          # }
        - JGI:organisms[].pi.institution
          # from: JGI:organisms[].pi.institution
          # via: {
          #   organisation_name: "JGI:organisms[].pi.institution"
          #}

      contributor_roles:
        description: List of one or more terms indicating the type of contribution. Should be a term from either CRedIT or DataCite's role vocabulary.
        multivalued: true
        inlined_as_list: true
        exact_mappings:
        - DataCite:attributes.contributors[].contributor_type
        - DataCite:attributes.creators[].contributor_type
        todos: add DataCite and Credit roles as enums
        related_mappings:
        - JGI:organisms[].pi
        # from: JGI:organisms[].pi
        # via: "DataCite:ProjectLeader"


  Organisation:
    description: an organization such as a company, university, or consortium
    class_uri: schema:Organization

    attributes:
      organisation_id:
        description: unique identifier for the organisation -- ROR / ISNI, etc.
        identifier: true
        examples:
        - value: ROR:01znn6x10
        exact_mappings:
        - DataCite:attributes.contributors[].affiliation.affiliation_identifier
        - DataCite:attributes.creators[].affiliation.affiliation_identifier
        range: uriorcurie

      organisation_name:
        description: name of the organisation
        exact_mappings:
        - DataCite:attributes.contributors[].affiliation.name
        - DataCite:attributes.creators[].affiliation.name
        - OSTI:research_organization
        - JGI:organisms[].pi.institution
        examples:
        - value: U.S. Department of Energy Systems Biology Knowledgebase
        - value: Lawrence Berkeley National Laboratory
        - value: The Ohio State Univ., Columbus, OH


  FundingReference:
    description: funding information about a single funding source
    attributes:
      funder_name:
        description: human-readable funding body name
        required: true
        exact_mappings:
        - DataCite:attributes.funding_references[].funder_name
        - CrossRef:Message.project.funding.funder.name
        - OSTI:sponsoring_organization
        examples:
        - value: US DOE Office of Science (SC), Biological and Environmental Research (BER)

      funder_id:
        description: ID for the funding entity - acceptable formats include crossref funder ID, DOI, ROR, ISNI, others?
        exact_mappings:
        - DataCite:attributes.funding_references[].funder_identifier
        - CrossRef:Message.project.funding.funder.id.id
        range: uriorcurie

      award_id:
        description: code assigned by the funder to the grant or award
        exact_mappings:
        - DataCite:attributes.funding_references[].award_number
        - CrossRef:Message.award

      award_title:
        description: human-readable title of the grant or award
        exact_mappings:
        - DataCite:attributes.funding_references[].award_title

      award_uri:
        description: URI for the award
        exact_mappings:
        - DataCite:attributes.funding_references[].award_uri
        range: uriorcurie


  ResolvablePID:
    description: a resolvable permanent ID
    attributes:
      id:
        identifier: true
        description: a resolvable URI or CURIE (compact URI) for a resource
        required: true
        examples:
        - value: DOI:10.25982/59912.37/1635154
        - value: OSTI:1635154
        - value: https://kbase.us/n/59912/37/
        exact_mappings:
        - DataCite:attributes.identifier.value
        - DataCite:attributes.alternate_identifiers[]
          # from: DataCite:attributes.alternate_identifiers[]
          # via: "{DataCite:attributes.alternate_identifiers[].alternate_identifier_type}:{DataCite:attributes.alternate_identifiers[].alternate_identifier}"
        - DataCite:attributes.related_identifiers[]
          # from: DataCite:attributes.related_identifiers[]
          # via: "{DataCite:attributes.related_identifiers[].related_identifier_type}:{DataCite:attributes.related_identifiers[].related_identifier}"
        - DataCite:attributes.identifiers[]
          # from: DataCite:attributes.identifiers[]
          # via: "{DataCite:attributes.identifiers[].identifier_type}:{DataCite:attributes.identifiers[].identifier}"
        related_mappings:
        - OSTI:site_url
        range: uriorcurie

      description:
        # slot_uri: schema:description
        description: brief description of what the ID links to
        exact_mappings:
        - OSTI:description
        examples:
        - value: This data analysis workflow demonstrates how to process a metagenome to identify viruses using VirSorter. Then, provides taxonomic classification using vConTACT2

      relationship_type:
        description: how the resource represented by this ID relates to the original resource, as described by DataCite relation types
        exact_mappings:
        # for the primary ID, we also need to represent the resource itself
        - DataCite:attributes.related_identifiers[].relation_type
        todos: add DataCite relation types as an enum


  EventDate:
    description: The date of a specified event.
    attributes:
      date:
        description: the date upon which the event occurred
        range: date_or_datetime
        required: true
        examples:
        - value: 2022-05-10

      date_type:
        description: the nature of the resource-related event that occurred on that date
        range: DateType
        required: true
        examples:
        - value: available
        - value: updated


enums:
  ResourceType:
    description: The type of resource being represented
    permissible_values:
      dataset:
      report:

  DateType:
    description: The type of date being represented
    permissible_values:
      accessed:
        description: The date that the resource was accessed.
      available:
        description: The date the resource is made publicly available. To indicate the end of an embargo period, use Available.
      updated:
        description: The date of the last update to the resource, when the resource is being added to.

  # TODO: use as range for 'contributors'
  # ContributorType:
  #   description: The type of contributor being represented
  #   permissible_values:
  #     Person:
  #     Organisation:
